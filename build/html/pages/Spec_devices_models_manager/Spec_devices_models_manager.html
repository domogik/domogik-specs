

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Device models management webapp (specifications) &mdash; Domogik specifications 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Domogik specifications 0.1 documentation" href="../../index.html" />
    <link rel="next" title="Data types of Domogik" href="../Spec_domogik_data_types/Spec_domogik_data_types.html" />
    <link rel="prev" title="Device template" href="../Spec_device_template/Spec_device_template.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Spec_domogik_data_types/Spec_domogik_data_types.html" title="Data types of Domogik"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Spec_device_template/Spec_device_template.html" title="Device template"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Domogik specifications 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="device-models-management-webapp-specifications">
<h1>Device models management webapp (specifications)<a class="headerlink" href="#device-models-management-webapp-specifications" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>This web app is a REST service to receives informations about devices models from the users.
There will be a small UI to display the informations sent and change their status</p>
</div>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>The webapp will need a basic authentication for the user interface. As there are no critical data, there is no need to have something heavily secured.
Login/password will be enough. All accounts will have the same grants.</p>
<p>The new accounts can be created only on command line with a tool like this: <em>python add_user my_login my_password</em>
To update a password, same thing : <em>python update_user my_login new_password</em>
To delete a user : same thing : <em>python delete_user my_login</em></p>
</div>
<div class="section" id="database-model">
<h2>Database model<a class="headerlink" href="#database-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="table-users">
<h3>Table : users<a class="headerlink" href="#table-users" title="Permalink to this headline">¶</a></h3>
<p>||Field|Type
user|string
password|password||</p>
</div>
<div class="section" id="table-data">
<h3>Table : data<a class="headerlink" href="#table-data" title="Permalink to this headline">¶</a></h3>
<p>||Field|Type|Description
id|int|PK
package_id|string|data from the user. See chapter &#8216;on domogik admin side&#8217;
device_type|string|data from the user. See chapter &#8216;on domogik admin side&#8217;
device_model_or_reference|string|data from the user. See chapter &#8216;on domogik admin side&#8217;
device_status|string|data from the user. See chapter &#8216;on domogik admin side&#8217;
issue_description|string|data from the user. See chapter &#8216;on domogik admin side&#8217;
user_email|string|data from the user. See chapter &#8216;on domogik admin side&#8217;
created_on|datetime|when the row is inserted
status|enum|NEW : when inserted, PROCESSING, PROCESSED
issue_url|string|url of the issue (when in status PROCESSING/PROCESSED) : null when row is inserted||
~~#F00:last_value ?~~</p>
</div>
</div>
<div class="section" id="how-it-will-work-uses-cases">
<h2>How it will work (uses cases)<a class="headerlink" href="#how-it-will-work-uses-cases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="on-domogik-admin-side">
<h3>On Domogik admin side<a class="headerlink" href="#on-domogik-admin-side" title="Permalink to this headline">¶</a></h3>
<p>There will be a button in the plugin devices view for each device. When clicking on the button the user will access to a form with these fields :</p>
<ul class="simple">
<li>package_id : &lt;package id&gt; (prefilled, not updatable)</li>
<li>device_type : &lt;device type&gt; (prefilled, not updatable)</li>
</ul>
<p>~~#F00:attention avec device_type dans le nouvau modèle: Il n&#8217;y a plus la notion de type. mais simplement un identifiant de template utilisé pour créer le device. cette donnée peut être nulle si le device a été créé manuellement, sans template. de plus ce champ devra être vidé si la structure du device à été modifiée~~
~~#F00:Il faudrait aussi voir si cereal à ajouté la version du template utilisé, pour les mise à jour~~</p>
<ul class="simple">
<li>device description (model, reference) : &lt;device model or reference&gt; (prefilled if possible, updatable by the user)</li>
<li>device status (list of choices) : works fine / don&#8217;t work / works a bit</li>
</ul>
<p>~~#F00:pour quelle utilisation?~~</p>
<ul class="simple">
<li>(displayed if status != works fine) issue description : &lt;informations from the user&gt;</li>
<li>user email : &lt;the user email&gt; (updatable, can be blank if the user don&#8217;t want to give its email)</li>
</ul>
<p>When the user validates the form, an url is called on the webapp with the data in a json format :
{</p>
<blockquote>
<div>&#8216;package_id&#8217; : ...
&#8216;device_type&#8217; : ...
&#8216;device_model_or_reference&#8217; : ...
&#8216;device_status&#8217; : ...
&#8216;issue_description&#8217; : ...
&#8216;user_email&#8217; : ...</div></blockquote>
<p>}</p>
<p>~~#F00:Et les paramètres?~~</p>
<p>The url should return a HTTP 200 (or 204 ?) response. If so, a success notification will be displayed. If not, an error notification will be displayed.</p>
<p>The url is configured in /etc/domogik/domogik.cfg so we can change it from a version to another one (in case we need to change it a day)</p>
</div>
</div>
<div class="section" id="on-the-webapp-side">
<h2>On the webapp side<a class="headerlink" href="#on-the-webapp-side" title="Permalink to this headline">¶</a></h2>
<p>There will be 2 &#8220;public&#8221; urls :
* /add (POST) : this is the url called by the domogik admin
~~#F00:Je comprends pas à quoi ca sert~~</p>
<ul class="simple">
<li>/ : the login box</li>
</ul>
<p>Some other urls will be needed (but users won&#8217;t need to know them) :
* /admin/* : all the pages of the admin</p>
<div class="section" id="the-add-url-is-called">
<h3>the /add url is called<a class="headerlink" href="#the-add-url-is-called" title="Permalink to this headline">¶</a></h3>
<p>Here is what should happen :
{code()}
check the content (correct values, ...)
check if there is no security issue (sql injection, ....)
store the data in database (add the current datetime, and the status &#8216;NEW&#8217;)
send an email to a mailing list to notify (can be disabled by config)
call a free url (to update a dashboard in the future)
{code}</p>
</div>
<div class="section" id="the-url-is-accessed">
<h3>the / url is accessed<a class="headerlink" href="#the-url-is-accessed" title="Permalink to this headline">¶</a></h3>
<p>A login box must be displayed. If the login/password is not good, display an error. If it is good, display the main niew</p>
<p>!!!!Main view
The main view will display a table will all non processed elements (status != PROCESSED). All elements with a KO status should be displayed first and be grouped by package id</p>
<p>If the &#8216;issue description&#8217; of an element is too big, we should truncate the display and if the user click on it display in a light box (or something like this) the full &#8216;issue description&#8217;</p>
<p>The following actions can be done on a &#8216;WORKS&#8217; device status element :
* set status to &#8216;PROCESSED&#8217;</p>
<p>The following actions can be done on a &#8216;DON&#8217;T WORK / WORKS A LITTLE&#8217; device status element :
* set status from &#8216;NEW&#8217; to &#8216;PROCESSING&#8217;. When this is done, a form &#8216;PROCESSING_ACTION&#8217; will be displayed.
* if the status was already to &#8216;PROCESSING&#8217;, click on the &#8216;PROCESSING&#8217; button. a form &#8216;PROCESSING_ACTION&#8217; will be opened
* set the status to &#8216;PROCESSED&#8217;</p>
<p>!!!!Form &#8216;PROCESSING_ACTION&#8217;
this form will have some fields :
* link to an issue on a tracker (free url). This field can be updated by the admin user
* link to send an email to the user. It should prefill the mail (if possible) with : the link to the issue on the tracked (previous field content), a title</p>
<p>All the debug about the issue must be handled in the issue on the tracker.</p>
<p>!!!!UI views</p>
<img alt="../../_images/441" src="../../_images/441" />
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The installation must respect the following rules :
* installer is in python
* all the installation options must be set as options for install.py</p>
<p>The installation must handle
* create the database
* (optionnal) import all tables from a sql file
* create an init.d file
* set the init.d to start on computer startup
* create the first admin account
* set email for notifications
* set if we send email or not
* set the free url for notification
* set if we want to call the url or not</p>
<p>Assuming the webapp sources are located in a folder named &#8216;dmm&#8217;, the install.py must be in this folder. The webapp will use the files from this folder to run/. The init script must be updated to use this folder.</p>
<p>We also need a &#8216;debian_install_dependancies.sh&#8217; script to :
* install needed packages</p>
<p>All this is required because we want to be able to recreate the application from scratch on a new server in case we lost the main server. As some backups will be done, the option to import data is needed.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Device models management webapp (specifications)</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
<li><a class="reference internal" href="#database-model">Database model</a><ul>
<li><a class="reference internal" href="#table-users">Table : users</a></li>
<li><a class="reference internal" href="#table-data">Table : data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-it-will-work-uses-cases">How it will work (uses cases)</a><ul>
<li><a class="reference internal" href="#on-domogik-admin-side">On Domogik admin side</a></li>
</ul>
</li>
<li><a class="reference internal" href="#on-the-webapp-side">On the webapp side</a><ul>
<li><a class="reference internal" href="#the-add-url-is-called">the /add url is called</a></li>
<li><a class="reference internal" href="#the-url-is-accessed">the / url is accessed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../Spec_device_template/Spec_device_template.html"
                        title="previous chapter">Device template</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../Spec_domogik_data_types/Spec_domogik_data_types.html"
                        title="next chapter">Data types of Domogik</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/pages/Spec_devices_models_manager/Spec_devices_models_manager.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Spec_domogik_data_types/Spec_domogik_data_types.html" title="Data types of Domogik"
             >next</a> |</li>
        <li class="right" >
          <a href="../Spec_device_template/Spec_device_template.html" title="Device template"
             >previous</a> |</li>
        <li><a href="../../index.html">Domogik specifications 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Domogik team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>