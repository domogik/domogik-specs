

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Purpose &mdash; Domogik specifications 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Domogik specifications 0.1 documentation" href="../../index.html" />
    <link rel="next" title="Table of contents" href="../plugin_velbus/plugin_velbus.html" />
    <link rel="prev" title="Purpose" href="../plugin_tts/plugin_tts.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../plugin_velbus/plugin_velbus.html" title="Table of contents"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../plugin_tts/plugin_tts.html" title="Purpose"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Domogik specifications 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="purpose">
<h1>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h1>
<p>This plugin&#8217;s goal is to control a Samsung television with EX-link port (sort of a serial port).</p>
<p>::{IMG(attId=&#8221;203&#8221;)}{IMG}:</p>
<div class="highlight-python"><pre>*************</pre>
</div>
<div class="section" id="ex-link-wire">
<h2>EX Link wire<a class="headerlink" href="#ex-link-wire" title="Permalink to this headline">¶</a></h2>
<div class="section" id="schematic">
<h3>Schematic<a class="headerlink" href="#schematic" title="Permalink to this headline">¶</a></h3>
<p>{IMG(attId=&#8221;149&#8221;)}{IMG}</p>
</div>
<div class="section" id="make-your-own-wire">
<h3>Make your own wire<a class="headerlink" href="#make-your-own-wire" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="materials-needed">
<h2>Materials needed<a class="headerlink" href="#materials-needed" title="Permalink to this headline">¶</a></h2>
<p>You need a simple stereo wire with a 3.5mm jack plug and a female DB9 :</p>
<p>{IMG(attId=&#8221;196&#8221;)}{IMG}</p>
<p>{IMG(attId=&#8221;197&#8221;)}{IMG} {IMG(attId=&#8221;198&#8221;)}{IMG}</p>
<p>Brase wire on DB9 like told in schematic :</p>
<p>{IMG(attId=&#8221;199&#8221;)}{IMG}</p>
<p>And finally, protect your new EX Link wire :</p>
<p>{IMG(attId=&#8221;200&#8221;)}{IMG}</p>
</div>
</div>
<div class="section" id="how-to-plug">
<h1>How to plug<a class="headerlink" href="#how-to-plug" title="Permalink to this headline">¶</a></h1>
<p>Just plug EX Link&#8217;s jack side on television like this :</p>
<p>{IMG(attId=&#8221;202&#8221;)}{IMG}</p>
<p>If your computer doesn&#8217;t have any serial port, you may need a serial&lt;=&gt;usb adaptator.</p>
<p>{IMG(attId=&#8221;201&#8221;)}{IMG}</p>
</div>
<div class="section" id="developper-notes">
<h1>Developper notes<a class="headerlink" href="#developper-notes" title="Permalink to this headline">¶</a></h1>
<p>No xPL schema exists for television control. We choose to use <a href="#id1"><span class="problematic" id="id2">`CONTROL.BASIC schema] to send commands. Acknowledgments will be made by a [http://xplproject.org.uk/wiki/index.php?title=Schema\_-\_SENSOR.BASIC|SENSOR.BASIC schema &lt;http://xplproject.org.uk/wiki/index.php?title=Schema\_-\_CONTROL.BASIC&gt;`_</span></a></p>
<div class="section" id="xpl-cmnd">
<h2>xpl-cmnd<a class="headerlink" href="#xpl-cmnd" title="Permalink to this headline">¶</a></h2>
<div class="highlight-json"><pre>xpl-cmnd
{
...
}
control.basic
{
device=&lt;television name&gt;
type=television
current=&lt;alias for command : power_on, channel_up, etc&gt;
[data1=&lt;optionnal value : current='channel', data1=1 to set channel 1&gt;]
}</pre>
</div>
</div>
<div class="section" id="xpl-stat">
<h2>xpl-stat<a class="headerlink" href="#xpl-stat" title="Permalink to this headline">¶</a></h2>
<p>||TODO : if we can get television power status, return this data||</p>
</div>
<div class="section" id="xpl-trig">
<h2>xpl-trig<a class="headerlink" href="#xpl-trig" title="Permalink to this headline">¶</a></h2>
<p>Acknowloedgment for successfull xpl-cmnd :
.. code-block:: json</p>
<blockquote>
<div>xpl-cmnd
{
...
}
sensor.basic
{
device=&lt;television name&gt;
type=television
current=&lt;alias for command : power_on, channel_up, etc&gt;
[data1=&lt;optionnal value : current=&#8217;channel&#8217;, data1=1 to set channel 1&gt;]
}</div></blockquote>
<div class="section" id="widgets-reflexion">
<h3>Widgets reflexion<a class="headerlink" href="#widgets-reflexion" title="Permalink to this headline">¶</a></h3>
<p>{IMG(attId=&#8221;148&#8221;)}{IMG}</p>
</div>
<div class="section" id="protocol">
<h3>Protocol<a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<p>See Proof of concept for the moment</p>
<p>Set volume to a level :
.. code-block:: json</p>
<blockquote>
<div>&#8220;x08x22x01x00x00x05xFF&#8221; ;      // Cmd: &#8220;Volume at 5/100&#8221;
octet 6=volume.</div></blockquote>
</div>
<div class="section" id="return">
<h2>Return<a class="headerlink" href="#return" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>&#8220;0x03 0x0C 0xFF&#8221; if error</li>
<li>&#8220;0x03 0x0C 0xF1&#8221; if OK.</li>
</ul>
<div class="section" id="proof-of-concept">
<h3>Proof of concept<a class="headerlink" href="#proof-of-concept" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="samsung-led-py-list-of-action-code">
<h2>samsung_led.py : list of action/code<a class="headerlink" href="#samsung-led-py-list-of-action-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-json"><pre>COMMANDS = {
"power_standby" : "00000001", # Power Standby    ### OK
"power_on" : "00000002", # Power On              ### OK
"get_power_status" : "00000000", # Get power status   ### ?????
"mute_toggle" : "02000000", # Mute toggle        ### OK
"volume_up" : "01000100", # Master Volume Up     ### OK
"volume_down" : "01000200", # Master Volume Down     ### OK
"channel_up" : "03000100", # Channel Up    ### OK
"channel_down" : "03000200", # Channel Down  ### ERR
"tv" : "0a000000", # TV       ### OK
"av1" : "0a000100", # AV 1       ### OK
"av2" : "0a000101", # AV 2       ### OK
"av3" : "0a000102", # AV 3       ### OK
"svideo1" : "0a000200", # S-Video 1     ### OK
"svideo2" : "0a000201", # S-Video 2     ### OK
"component1" : "0a000300", # Component 1    ### OK
"component3" : "0a000302", # Component 3    ### OK
"pc1" : "0a000400", # PC 1     ### OK
"pc2" : "0a000401", # PC 2     ### OK
"hdmi1" : "0a000500", # HDMI 1   ### OK
"hdmi2" : "0a000501", # HDMI 2   ### OK
"hdmi3" : "0a000502", # HDMI 3   ### OK
"hdmi4" : "0a000503", # HDMI 4   ### OK
"dvi1" : "0a000600", # DVI 1   ### OK
"dvi2" : "0a000601", # DVI 2   ### OK
"dvi3" : "0a000602", # DVI 3   ### OK
"dynamic" : "0b000000", # Dynamic
"standard" : "0c000000", # Standard
"wide" : "0b000002", # Wide
"black_adjust_off" : "0b090000", # Black Adjust Off
"black_adjust_medium" : "0b090002", # Black Adjust Medium
"black_adjust_low" : "0b090001", # Black Adjust Low
"black_adjust_high" : "0b090003", # Black Adjust High
"dynamic_contrast_off" : "0b090100", # Dynamic Contrast Off
"dynamic_contrast_low" : "0b090101", # Dynamic Contrast Low
"dynamic_contrast_medium" : "0b090102", # Dynamic Contrast Medium
"dynamic_contrast_high" : "0b090103", # Dynamic Contrast High
"color_space_auto" : "0b090300", # Color Space Auto
"color_space_wide" : "0b090301", # Color Space Wide

# Others
"aspect_16_9" : "0b0a0100", # 16/9 aspect
"aspect_zoom_1" : "0b0a0101", # Zoom 1 aspect
"aspect_zoom_2" : "0b0a0102", # Zoom 2 aspect
"aspect_wide_fit" : "0b0a0103", # Wide Fit aspect
"aspect_4_3" : "0b0a0104", # 4/3 aspect
"speaker_off" : "0c060000", # Speaker Off
"speaker_on" : "0c060001", # Speaker On

# Sound commands
"sound_standard" : "0c000000", # Standard
"sound_music" : "0c000001", # Music
"sound_movie" : "0c000002", # Movie
"sound_custom" : "0c000004", # Custom
"sound_eq_standard" : "0c010000", # EQ Standard
"sound_eq_music" : "0c010001", # EQ Music
"sound_eq_video" : "0c010002", # EQ Movie
"sound_eq_speech" : "0c010003", # EQ Speech
"sound_eq_custom" : "0c010004", # EQ Custom
"sound_srs_tru_surround_on" : "0c020000", # SRS Tru Surround On
"sound_srs_tru_surround_off" : "0c020001", # SRS Tru Surround Off
"sound_multi_track_mono" : "0c040000", # Multi-Track Mono
"sound_multi_track_stereo" : "0c040001", # Multi-Track Stereo
"sound_multi_track_sap" : "0c040002", # Multi-Track SAP

# Tests
"test" : "04010002", # Channel 2 on TNT
"test" : "04000002", # Channel 2 on Classical TV
}</pre>
</div>
</div>
<div class="section" id="tv-test-py-pof">
<h2>tv_test.py : pof<a class="headerlink" href="#tv-test-py-pof" title="Permalink to this headline">¶</a></h2>
<div class="highlight-json"><pre>#!/usr/bin/python
# -*- coding: utf-8 -*-

import binascii
import serial
from samsung_led import COMMANDS
import sys


class SamsungTVException(Exception):
    """
    Samsung television control exception
    """

    def __init__(self, value):
        Exception.__init__(self)
        self.value = value

    def __str__(self):
        return repr(self.value)


class SamsungTV:
    """ Control samsung television
    """

    def __init__(self, log = None, callback = None):
        """ Init samsung TV controller
        """
        self._log = log
        self._callback = callback
        self._samsung = None


    def open(self, device):
        """ Open EX Link
            @param device : serial port connected to EX Link
        """
        try:
            print("Try to open Samsung EX Link device : %s" % device)
            self._samsung = serial.Serial(device, 9600,
                                parity=serial.PARITY_NONE,
                                stopbits=serial.STOPBITS_ONE,
                                xonxoff=serial.XOFF)
            print("EX Link device opened")
        except:
            error = "Error while opening EX Link device : %s. Check if it is the good device or if you have the good permissions on it." % device
            raise SamsungTVException(error)


    def send(self, cmd_alias):
        """ Send command code associated to alias to EX Link
            @param cmd_alias : alias
        """
        print cmd_alias
        if not cmd_alias in COMMANDS:
            print "Command not known : '%s'" % cmd_alias
            return
        cmd = self.generate_command(COMMANDS[cmd_alias])
        print cmd
        data = binascii.unhexlify(cmd)
        self._samsung.write("%s" % data)
        #res = ser.read(16)
        #print "res=%s" % res

    def generate_command(self, value):
        """ Generate command with header and checksum
        """
        # TODO : review quality
        HEADER="0822"
        data = value.decode("hex")
        sum = 0
        for byte in data:
            sum += ord(byte)
        sum+=42
        CS=generatechecksum(HEADER+value)
        return HEADER+value+CS


    def close(self):
        """ Close EX Link
        """
        self._samsung.close()



#### for test purpose : taken from http://www.avsforum.com/avs-vb/showthread.php?t=703453
def generatechecksum(value):
    data = value.decode("hex")

    sum = 0
    for byte in data:
        sum += ord(byte)
    print "Two's complement:", hex((~sum + 1) &amp;amp; 0xFF)
    data = hex((~sum + 1) &amp;amp; 0xFF)
    data = str(data)[2:]
    if ( len(data) &lt; 2 ):

       data = '0' + data
    print "checksum " + data
    return data


#print generatechecksum("01000100")
my_tv = SamsungTV(None, None)
my_tv.open(0)
my_tv.send(sys.argv[1])
my_tv.close()</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Purpose</a><ul>
<li><a class="reference internal" href="#ex-link-wire">EX Link wire</a><ul>
<li><a class="reference internal" href="#schematic">Schematic</a></li>
<li><a class="reference internal" href="#make-your-own-wire">Make your own wire</a></li>
</ul>
</li>
<li><a class="reference internal" href="#materials-needed">Materials needed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-plug">How to plug</a></li>
<li><a class="reference internal" href="#developper-notes">Developper notes</a><ul>
<li><a class="reference internal" href="#xpl-cmnd">xpl-cmnd</a></li>
<li><a class="reference internal" href="#xpl-stat">xpl-stat</a></li>
<li><a class="reference internal" href="#xpl-trig">xpl-trig</a><ul>
<li><a class="reference internal" href="#widgets-reflexion">Widgets reflexion</a></li>
<li><a class="reference internal" href="#protocol">Protocol</a></li>
</ul>
</li>
<li><a class="reference internal" href="#commands">Commands</a></li>
<li><a class="reference internal" href="#return">Return</a><ul>
<li><a class="reference internal" href="#proof-of-concept">Proof of concept</a></li>
</ul>
</li>
<li><a class="reference internal" href="#samsung-led-py-list-of-action-code">samsung_led.py : list of action/code</a></li>
<li><a class="reference internal" href="#tv-test-py-pof">tv_test.py : pof</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../plugin_tts/plugin_tts.html"
                        title="previous chapter">Purpose</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../plugin_velbus/plugin_velbus.html"
                        title="next chapter">Table of contents</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/pages/plugin_tv_samsg/plugin_tv_samsg.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../plugin_velbus/plugin_velbus.html" title="Table of contents"
             >next</a> |</li>
        <li class="right" >
          <a href="../plugin_tts/plugin_tts.html" title="Purpose"
             >previous</a> |</li>
        <li><a href="../../index.html">Domogik specifications 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Domogik team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>